# Картошка. Усложненный вариант

“Картошка” - это отечественный электронный кошелек, который позволяет оплачивать услуги, делать денежные переводы в
рамках системы.
Ваша задача написать серверную часть, удовлетворяющую “Картошке”

## Глоссарий

CRUD (create, retrieve, update, delete) - создание, получение, обновление, удаление ресурса. Если нет какой-то буквы, то
она заменяется \*. Подразумевается, что такой функционал отсутствует.

### Пример

_“CR*D книги” - подразумевает создание, получение, удаление книги, но без её изменения_

## Требования к серверной части

* CRU* пользовательский аккаунт
* Возможность войти и выйти из аккаунта
* \*R** пользовательский кошелек
* Отправить перевод
* Выставить счет на оплату за услугу
* Оплатить услугу
* Пополнить кошелек
* Посмотреть историю операций по кошельку

# Спецификация

## Пользователь

<details>
<summary><strong>GET /users/{id}</strong></summary>
Возвращает информацию о пользователе по его идентификатору

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Расположение | Тип    | Описание                   |
|----------|--------------|--------|----------------------------|
| id       | queryParams  | string | идентификатор пользователя |

### Response

| Http code | Описание                   |
|-----------|----------------------------|
| 200       | Успешный вызов             |
| 401       | Требуется авторизация      |
| 403       | Доступ запрещен            |
| 404       | Пользователь не найден     |
| 500       | Внутренняя ошибка          |
| 503       | Сервис временно недоступен |

Пример при http code == 200:

```json
{
  "id": "uuid",
  "walletId": "string",
  "firstName": "string",
  "lastName": "string",
  "fullName": "string", //firstName + ' ' + lastName
  "email": "string",
  "phone": long,
  "registrationDate": "dd-mm-yyyy",
  "lastUpdateDate": "dd-mm-yyyy",
  "age": int
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

<details>
<summary><strong>POST /users</strong></summary>
Регистрирует нового пользователя

### Request

#### Parameters

| Свойство  | Расположение | Тип    | Описание                                                              |
|-----------|--------------|--------|-----------------------------------------------------------------------|
| phone     | body         | long   | Номер телефона  пьльзователя                                          |
| password  | body         | string | Пароль пользователя                                                   |
| firstName | body         | string | Имя пользователя                                                      |
| lastName  | body         | string | Фамилия пользователя                                                  |
| email     | body         | string | Электронная почта пользователя                                        |
| age       | body         | int    | Возраст пользователя. Допустимый возраст регистрации от 18 до 100 лет |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
{
  // empty
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

<details>
<summary><strong>PATCH /users/{id}</strong></summary>
Обновляет информацию о пользователе

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство  | Обязательное | Расположение | Тип    | Описание                       |
|-----------|--------------|--------------|--------|--------------------------------|
| id        | да           | queryParams  | string | Идентификатор пользователя     |
| firstName | нет          | body         | string | Имя пользователя               |
| lastName  | нет          | body         | string | Фамилия пользователя           |
| email     | нет          | body         | string | Электронная почта пользователя |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 401       | Требуется авторизация         |
| 403       | Доступ запрещен               |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
{
  "id": "uuid",
  "walletId": "string",
  "firstName": "string",
  "lastName": "string",
  "fullName": "string", //firstName + ' ' + lastName
  "email": "string",
  "phone": long,
  "registrationDate": "dd-mm-yyyy",
  "lastUpdateDate": "dd-mm-yyyy",
  "age": int
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

## Сессия

<details>
<summary><strong>GET /users/sessions</strong></summary>
Возвращает информацию сессиях пользователя

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Расположение | Тип | Описание |
|----------|--------------|-----|----------|

### Response

| Http code | Описание                   |
|-----------|----------------------------|
| 200       | Успешный вызов             |
| 401       | Требуется авторизация      |
| 500       | Внутренняя ошибка          |
| 503       | Сервис временно недоступен |

Пример при http code == 200:

```json
[
  {
    "id": "uuid",
    "userId": "uuid",
    "expirationTime": "dd-mm-yyyy",
    "active": boolean
  },
  {
    ...
  }
]
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

<details>
<summary><strong>GET /users/sessions/current</strong></summary>
Возвращает информацию о текущей сессии пользователя

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Расположение | Тип | Описание |
|----------|--------------|-----|----------|

### Response

| Http code | Описание                   |
|-----------|----------------------------|
| 200       | Успешный вызов             |
| 401       | Требуется авторизация      |
| 500       | Внутренняя ошибка          |
| 503       | Сервис временно недоступен |

Пример при http code == 200:

```json
{
  "id": "uuid",
  "userId": "uuid",
  "expirationTime": "dd-mm-yyyy",
  "active": boolean
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

<details>
<summary><strong>POST /users/sessions</strong></summary>
Осуществляет вход пользователя в систему. Возможно иметь несколько активных сессий.

### Request

#### Parameters

| Свойство | Расположение | Тип    | Описание                                                |
|----------|--------------|--------|---------------------------------------------------------|
| phone    | body         | long   | Номер телефона пользователя, ассоциируемого с аккаунтом |
| password | body         | string | Пароль пользователя                                     |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
{
  "id": "uuid",
  "userId": "uuid",
  "token": "string",
  "expirationTime": "dd-mm-yyyy"
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

<details>
<summary><strong>DELETE /users/sessions/{id}</strong></summary>
Удаляет сессию пользователя

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Расположение | Тип    | Описание                          |
|----------|--------------|--------|-----------------------------------|
| id       | queryParams  | string | Идентификатор сессии пользователя |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 401       | Требуется авторизация         |
| 403       | Доступ запрещен               |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
{
  //empty
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

## Кошелек

<details>
<summary><strong>GET /wallet/bill</strong></summary>
Возвращает информацию о счете пользователя

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Расположение | Тип | Описание |
|----------|--------------|-----|----------|

### Response

| Http code | Описание                   |
|-----------|----------------------------|
| 200       | Успешный вызов             |
| 401       | Требуется авторизация      |
| 500       | Внутренняя ошибка          |
| 503       | Сервис временно недоступен |

Пример при http code == 200:

```json
{
  "id": "uuid",
  "amount": long,
  "lastUpdate": "dd-mm-yyyy"
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

### Пополнение кошелька

<details>
<summary><strong>POST /hesoyam </strong></summary>
Пополняет кошелек с вероятностью 25%. Если не повезло, то повторную попытку пополнения можно сделать через 30 секунд. Если было 3 раза неудача, то на 4ый раз гарантировано пополняется счет

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Расположение | Тип  | Описание                                                                     |
|----------|--------------|------|------------------------------------------------------------------------------|
| amount   | body         | long | Количество копеек, зачисляемых на кошелек. Максимальное количество - 1000000 |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 401       | Требуется авторизация         |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
{
  "billId": "uuid",
  "amount": long
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

## Денежные операции

<details>
<summary><strong>GET /history </strong></summary>
Возвращает историю операций по кошельку

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Обязательный | Расположение  | Тип  | Описание                                                                                                                                                                                                                                                                         |
|----------|--------------|---------------|------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| type     | нет          | filter params | enum | При указании параметра фильтрации возвращает историю, исходя из типа операции. При `type = transfer` возвращаются операции с переводом денежных средств, при `type = payment` возвращаются операции оплаты услуги, `type = refill` возвращаются операции пополнения своего счета |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 401       | Требуется авторизация         |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
[
  {
    "id": "uuid",
    "amount": long,
    "transactionDate": "string",
    "type": "transfer/payment",
    "receiverPhone": long, // optional. Used for type = transfer
    "maintenanceNumber": long, // optional. Used for type = payment,
    "status": "successful"
  }
]
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

<details>
<summary><strong>POST /transfers </strong></summary>
Денежная транзакция, используемая для оплаты услуги и отправки перевода

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство          | Обязательный | Расположение | Тип  | Описание                                                                        |
|-------------------|--------------|--------------|------|---------------------------------------------------------------------------------|
| receiverPhone     | нет          | body         | long | Номер телефона получателя. Указывается, если не указан maintenanceNumber        |
| maintenanceNumber | нет          | body         | long | Номер выставленного счета на оплату. Указывается, если не указан  receiverPhone |
| amount            | да           | body         | long | Количество копеек                                                               |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 401       | Требуется авторизация         |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
{
  "id": "uuid",
  "userId": "uuid",
  "wallet": {
    "id": "uuid",
    "amount": long
  }
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

<details>
<summary><strong> GET /maintenance </strong></summary>
Возвращает информацию об счетах

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Обязательное | Расположение  | Тип    | Описание                                                                                           |
|----------|--------------|---------------|--------|----------------------------------------------------------------------------------------------------|
| type     | нет          | filter params | string | Тип счета. Возможные значения: inbound - выставленный счет пользователю, outbound - исзодящий счет |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 401       | Требуется авторизация         |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
[
  {
    "id": "uuid",
    "type": "inbound/outbound",
    "amount": long,
    "maintenanceNumber": long,
    "status": "enum", //paid/unpaid
    "transactionDate": "dd-mm-yyyy"
  }
]
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>

<details>
<summary><strong> POST /maintenance </strong></summary>
Генерирует счет на оплату

### Request

Для вызова требуется передача токена авторизации в заголовке

#### Parameters

| Свойство | Расположение | Тип    | Описание                                                              |
|----------|--------------|--------|-----------------------------------------------------------------------|
| phone    | body         | long   | Номер телефона получателя, который должен будет оплатить обслуживание |
| amount   | body         | long   | Количество копеек                                                     |
| comment  | body         | string | Комментарий копеек                                                    |

### Response

| Http code | Описание                      |
|-----------|-------------------------------|
| 200       | Успешный вызов                |
| 400       | Передан некорректный параметр |
| 401       | Требуется авторизация         |
| 500       | Внутренняя ошибка             |
| 503       | Сервис временно недоступен    |

Пример при http code == 200:

```json
{
  "id": "uuid",
  "maintenanceNumber": long,
  "status": "enum" //unpaid
}
```

Пример при http code != 200:

```json
{
  "message": "string"
}
```

</details>